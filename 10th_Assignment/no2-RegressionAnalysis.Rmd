---
title: "10th Week assignment - 2. Regression analysis "
subtitle: '식비지출과 연간소득의 관계, 회귀분석'
author: "서강대학교 20121802 김재현"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: True
    toc_float: True
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readxl)
```

# 2. 교재 411페이지에 나와 있는 논의 사항 3번: 

한 가구에서 1년 동안 소비하는 **식비지출이 연간소득과 어떠한 관계가 있는지**를 파악하기 위하여, 회귀분석을 실시한 결과 다음과 같은 추정된 회귀방정식을 얻을 수 있었으며, 연간소득에 대한 회귀계수는 유의수준 5%에서 유의한 수치로 나타났다.

식비지출(hat) = a + b(연간소득)

---

## (1) 타당성, 회귀계수 통계적 유의성  
**이러한 회귀방정식이 타당한 지에 대하여 논의하시오. 또한, 연간소득에 대한 회귀계수의 값이 매우 적은 수임에도 불구하고 유의수준 5%에서 유의한 수치가 될 수 있는지에 대하여 논의하시오.**

```{r echo=FALSE}
getwd()
```

```{r}
df1 = read_xls('식비지출.xls',range='A1:D51')
```
```{r}
head(df1)
```

```{r}
summary(df1)
```

식비지출이 연간소득과 어떠한 관계가 있는지를 파악하는 문제이기 때문에, Food.Consumption, Income 두 변수에 대한 회귀분석을 진행한다. 식비지출을 종속변수로하고, Income을 독립변수로 한다.

```{r}
lm(df1$FoodConsumption~df1$Income)
```

회귀분석을 통하여 적합한 모형은 다음과 같다.
$y = 714.05477 + 0.05813x(x=Income,y=FoodConsumption)$

회귀계수 중 기울기 $\beta = 0.05813$으로 매우 작다.

$\beta$가 통계적으로 유의한지 확인하기 위해 검정통계량과 p값을 이용하여 가설검정을 진행한다.

가설검정에서 귀무가설은 H0 : $\beta = 0$, 대립가설은 H1 : $\beta\neq0$로 진행한다.

회귀계수 $\beta$에 대한 가설검정에 사용할 검정통계량과 p값은 다음에서 확인할 수 있다.

```{r}
summary(lm(df1$FoodConsumption~df1$Income))
```

$\beta$의 검정통계량 t = 4.602이며, p값은 $3.08\times 10^{-5}$ 이다.  
먼저 p값이 유의수준 5%보다 매우 작기 때문에, 이를 통해 귀무가설을 기각할 수 있다.

또한 검정통계량 t의 p값을 계산하여 가설검정을 할 수 있다.

```{r}
2*(1-pt(4.602,50-2))
```

회귀계수 중 절편 $\alpha$의 추정량 a에 대한 가설 검정이 필요하다. 회귀계수에 대한 유의수준 5%를 적용하면, 추정량 a의 p값은 0.00795(위 `summary(lm(df1$FoodConsumption~df1$Income))`에서 확인할 수 있다.)로 유의수준보다 매우 작기 때문에 귀무가설(H0: $\alpha = 0$)을 기각할 수 있다.

---

## (2) 회귀모형 사용을 위해 필요한 추가 분석  
**문제에서 나타난 내용을 가지고, 회귀모형을 사용하여도 괜찮은지를 판단할 수 있는가? 어떠한 분석이 추가적으로 실시되어야 하는지에 대하여 논의하시오.**

잔차분석을 진행하여 회귀분석에 요구되는 5가지 가정을 만족하는지 확인할 필요가 있다.

1. R에서 `gvlma::gvlma()`를 활용하여 추정된 회귀모형에 대한 잔차분석을 진행한다.
2. 만약 Heteroscedasticity 항목에서 p값이 유의수준보다 낮다면, 이는 등분산성 가정이 깨졌을 수 있다. 추가적으로 `car::ncvTest()`를 진행하여 등분산성 가정에 문제가 있는지 확인하고, 문제가 있다면 등분산성 가정을 만족 시키기 위해 분산 안정화 변환을 사용한다. 주로 log변환을 많이 사용하며, 분산의 변화가 심한 경우 power 변환(R-> `car::slp()`), Box-Cox변환(R-> `car::powerTransform()`)을 진행한다.
3. 비대칭도skewness와 첨도kurtosis는 정규성을 진단하는데 사용한다. 그러나 회귀분석에서 정규성에 대한 가정은 그리 중요하지 않다. 가우스-마코브 정리에 따르면, 최소제곱법을 이용한 회귀모형 추정에서는, 잔차가 정규분포를 따르지 않더라도 최상의 추정량(BLUE: Best Linear Unbiased Estimator)을 제공한다고 한다.
4. 만약 Global Stat, Link Function 항목에서 p값이 유의수준보다 낮은 경우, 모형에 선형성 가정에 문제가 있을 수 있다. 그러나 데이터의 갯수가 많지 않을 경우, 영향점(infulential point)의 영향으로 나타났을 문제일 수 있다. 이때는 산점도와 외적 스튜던트화된 잔차도를 통해 극단값을 넓게 조망해보고, 레버리지, DFFITS 통계량, Cook's D 통계량을 통해 영향점을 찾아내는 것이 좋다.
5. 잔차의 독립성을 확인하기 위해 Durbin-Watson 검정을 실행한다. R에서는 `car::durbinWatsonTest()`를 이용하여 검정할 수 있다. 귀무가설은 '자기상관계수가 상관관계를 갖지 않는 0이다.'이므로 p값이 유의수준보다 크면 잔차의 독립성이 확보되고 있다고 판단할 수 있다.

---

## (3) 3천만원의 연간소득을 갖는 가구가 1년 동안에 소비하는 식비지출은 어느 정도인가?

주어진 데이터에서 식비지출과 연간소득의 단위를 [만원]이라 가정했을 경우, 회귀 모형 $y = 714.05477 + 0.05813x(x=Income,y=FoodConsumption)$ 를 이용하면

```{r}
y = 714.05477 + 0.05813*3000
y
```
8,884,448원임을 추정할 수 있다.

---

## (4) 4천만원의 연간소득을 갖는 가구가 1백3십만원을 식비지출로 지출하였다면, 잔차는 얼마인가?
잔차$e_i = y_i-\hat{y_i}$ 이므로 잔차를 구하기 위해선 $\hat{y_i}$를 구해야 한다.

회귀 모형 $y = 714.05477 + 0.05813x(x=Income,y=FoodConsumption)$ 를 이용하고, 주어진 데이터에서 식비지출과 연간소득의 단위를 [만원]이라 가정했을 경우 
```{r}
y = 714.05477 + 0.05813*4000
y
```

 $\hat{y_i}=946.5748$ 이므로 잔차$e_i = y_i-\hat{y_i} = 130-946.5748$
```{r}
130-946.5748
```

잔차 $e_i = -816.5748$ 이다.
 
---

## (5) 잔차가 양의 값을 나타내는 경우와 음의 값을 나타내는 경우의 차이에 대하여 논의하시오.

잔차가 양의 값을 나타내는 경우는 실제값이 예측값보다 크다는 의미다. 그러므로, 연간소득으로 식비지출을 과소하게 예상했다는 의미를 가진다.

반대로, 잔차가 음의 값을 나타내는 경우는 예측값이 실제값보다 크다는 의미다. 그러므로 연간소득으로 식비지출을 과다하게 예상했다는 의미를 가진다.

