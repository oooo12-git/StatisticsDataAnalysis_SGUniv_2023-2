---
title: "12th_Assignment"
author: "서강대학교 20121802 김재현"
date: 2023-11-29
format: html
---

## 1. 회귀분석을 이용하여 예측값에 대한 오차는 어떠한 요인에 의하여 영향을 받는지를 논의하시오.

### 1.1 비선형

만약 모집단이 비선형이면, 회귀분석을 이용하여 회귀모형으로 적합할 경우 잔차가 무작위가 아닌 특별한 패턴을 갖는다.

### 1.2 오차항의 독립성

잔차가 서로 독립적이지 않다면, 잔차가 서로에게 영향을 준다는 것이다.

### 1.3 오차항의 기대값이 0 (불편성)

불편성을 만족하지 못한다면, 데이터 측정 과정에서 오차가 발생했을 가능성이 있다. 이는 오차에 바이어스를 가져다 준다.

### 1.4 오차항의 등분산성

잔차의 등분산성이 깨지면 $\hat{y}$ 값에 따라 잔차가 패턴을 갖는다. 등분산성이 깨졌다는 것을 확인하면, 변수 변환을 통해 등분산성을 갖도록 해야 한다.

### 1.5 오차항의 정규성

오차항이 정규분포를 이룬다고 가정하나 이는 가우스 마코브 정리에 따라 완화하여 적용할 수 있다.

### 1.6 영향점

잔차가 극단값을 갖고 레버리지가 큰 관측값은 영향점일 가능성이 크다. 영향점은 회귀모형을 적합하는데 지대한 영향을 미쳐서, 예상과 전혀 다른 모형을 적합하게 하기도 한다. 

### 1.7 다중공선성

독립변수간에 높은 상관관계가 있는 경우 분산이 팽창하여 모형 정확도가 떨어지고 회귀계수나 예측값에 대하여 안정적인 결과를 제공하지 못한다. 

## 4. (경로분석 문제) 22장에 소개된 아파트 매매자료를 이용하여 다음 물음에 답하시오.

```{r}
#| label: 데이터 불러오기
#| output: false

library(readxl)
data1 = read_excel("apartment.xlsx",range = "B4:E30")
```

```{r}
#| label: 데이터 data1 확인

head(data1)

```

### (1) 종속변수를 아파트 매매가격으로 하고, 독립변수를 면적과 방의 수로 하여 다중회귀분석을 실시하고, 여기서 추정된 회귀계수의 의미에 대하여 설명하시오.

```{r}
#| label: 다중회귀분석 lm()

M1 = lm(Sales ~ Area + Rooms, data1)
summary(M1)
```

위 결과를 통해 추정한 회귀 모형은 다음과 같다.
$$y = 54.1930 + 4.4339x_1-0.3934x_2$$
$$(y=Sales, x_1 = Area, x_2 = Rooms)$$
그러나, Rooms의 회귀계수는 t검정에 의한 p-value가 0.9492로 귀무가설을 기각하지 못한다. 그러므로, 독립변수 Rooms는 제외하는 편이 나을 것이라 예상할 수 있다.

### (2) 종속변수를 아파트 매매가격으로 하고, 독립변수를 면적으로 한 단순회귀분석과 종속변수를 아파트 매매가격으로 하고, 독립변수를 방의 수로 한 단순회귀분석을 실시하고, 여기서 추정된 회귀계수의 의미에 대하여 설명하시오.

```{r}
#| label: 아파트 매매가격 ~ 면적 회귀분석
summary(lm(Sales ~ Area, data1))
```
위 결과를 통해 추정한 회귀 모형은 다음과 같다.
$$y = 53.2303 + 4.4015x_1$$
$$(y=Sales, x_1 = Area)$$

위 회귀 모형을 통해 면적과 매매가격에 양의 상관관계가 있음을 확인할 수 있다.

```{r}
#| label: 아파트 매매가격 ~ 방의수 회귀분석
summary(lm(Sales ~ Rooms, data1))
```

위 결과를 통해 추정한 회귀 모형은 다음과 같다.
$$y = 39.03 + 30.91x_2$$
$$(y=Sales, x_2 = Rooms)$$

위 회귀모형을 통해 매매가격과 방의수 사이에는 양의 상관관계가 있음을 확인할 수 있다.

두 독립변수 모두 매매가격을 종속변수로 하여 각각 회귀분석을 했을 경우 회귀계수의 p-value가 매우 작은 수준으로 귀무가설을 기각한다. 때문에 두 회귀 계수 모두 통계적으로 유의하다.

### (3) (1)과 (2)의 회귀계수 결과가 다르게 나타나는 이유에 대하여 논의하시오.

(1)에서는 두 개의 독립변수를 사용하는 다중회귀분석을 진행하였다. 이때는 독립변수의 수가 두 개 이상이므로 다중공선성의 문제가 발생할 수 있다. 면적과 방의 수는 상관관계가 큰 독립변수이기 때문에 다중공선성의 문제가 발생한 것으로 보인다. 이로 인해, (1)에서 Rooms의 회귀계수가 예상과 다르게 음수가 나왔으며, 회귀 계수에 대한 t검정에 의한 p-value가 매우 높았던 것을 확인했다.

(2)에서는 두 개의 독립변수가 각각 매매가격과 단순회귀분석을 할 경우 통계적으로 유의한 회귀계수를 갖는다는 것을 볼 수 있다. 다만, Rooms 보단, Area가 훨씬 높은 adj -$R^2$ 를 보여주면서, 매매가격을 설명하는데 더 적합한 독립변수임을 알 수 있다. 

### (4) 방의 수가 1개 증가하는 경우, 면적이 평균적으로 얼마만큼 증가하는가?

```{r}
#| label: 면적 ~ 방의 수 회귀분석

summary(lm(Area ~ Rooms, data1))
```

위 결과를 통해 추정한 회귀 모형은 다음과 같다.
$$x_1 = -3.419 + 7.059x_2$$
$$(x_1=Area,x_2=Rooms)$$

방의 수가 1개 증가할 때 면적은 평균적으로 7.059 증가한다.

### (5) 동일한 면적의 아파트에서, 다른 아파트보다 방의 수가 1개 많은 경우, 매매가격이 어떻게 변하는지를 알아보고 (이러한 차이를 방의 수에 따른 직접효과(direct effect)라고 한다) 방의 수가 1개 증가함으로서 아파트 면적이 증가하여 나타나는 매매가격의 변화(이러한 차이를 방의 수에 따른 간접효과(indirect effect)라고 한다)에 대하여 설명하시오

#### (5-1) 동일한 면적 아파트에서 방의 수가 1개 많은 경우 매매가격이 어떻게 변하는지 알아보기(직접효과)

```{r}
#| label: 데이터 min, max 값 확인

min(data1$Area); max(data1$Area);
```


```{r}
#| label: 면적이 동일하고 방의 수가 다른 데이터 찾기

for (i in 16:54) {
  if(sum(data1$Area == i) > 1){
    print(i)
  }
  else{}
}

```

```{r}
#| label: 데이터 확인

data1_subset1 = data1[data1$Area %in% c(24,28,30,33,35),c(3,4)]
data1_subset1[order(data1_subset1$Area),]
```

28평, 33평 데이터로 면적이 같은 상태에서 방의 수에 따라 매매가격이 어떻게 변하는지 살펴볼 수 있다.

```{r}
#| label: 28평, 33평 subset 뽑아내기

data1_28A = data1[data1$Area %in% c(28),]
data1_33A = data1[data1$Area %in% c(33),]
```

```{r}
#| label : 28평 데이터를 이용하여 매매가격, 방의수 회귀 분석

lm(Sales~Rooms,data1_28A)
```

28평의 경우 Rooms의 회귀계수가 음수이다. 이는 방의 수가 늘어나면 매매가격이 떨어진다는 것을 의미한다.

그러나, 33평의 경우에는 반대 양상을 보인다.

```{r}
#| label : 33평 데이터를 이용하여 매매가격, 방의수 회귀 분석

lm(Sales~Rooms,data1_33A)
```

그러나, 33평의 경우 Rooms의 회귀계수가 양수이다. 이는 방의 수가 늘어나면 매매가격이 높아진다는 것을 의미한다.


```{r}
#| label: 혼란변수 확인(Duration)

data1_33A
data1_28A
```

Duration에 의해 방의 수와 관계없이 매매가격이 변하였는지 확인해보았다. 하지만, 두 데이터에서 모두 방의수가 작은 경우 Duration이 길었으며, 33평은 Duration이 긴 경우에도 매매 가격이 작았기 때문에, Duration이 혼란변수로 작용했을 가능성은 낮다고 판단한다.

때문에, 위 결과를 미루어 보아 면적이 같을 때, 매매가격에 대해 방의 수가 끼치는 직접효과(direct effect)는 없는 것으로 추정할 수 있다. 이러한 결과는 데이터 수가 작기 때문에 나타났을 가능성이 커보인다.

#### (5-1) 방의 수가 1개 증가함으로서 아파트 면적이 증가하여 나타나는 매매가격의 변화(간접효과)

```{r}
#| label: 매매가격 면적 회귀모형
summary(lm(Sales~Area,data1))
```

$$y= 53.2303 + 4.4015x_1$$

```{r}
#| label: 매매가격 방의수 회귀모형

summary(lm(Area~Rooms,data1))
```

$$x_1= -3.419 + 7.059x_2$$

위 두 식을 연립하면
$$y = 53.2283 + 4.4016(-3.419 + 7.059x_2)$$
$$y=31.07089x_2 + (53.2283+4.4016*(-3.419))$$

그러므로, 방의수가 1 증가할 때마다, 매매가격은 31.07089 증가하는 간접효과를 보여주고 있다.

### (6) 앞에서 얻은 결과를 종합하여, 방의 수가 1개 증가하게 되면, 매매가격은 어떻게 변하는지를 아래 그림을 이용하여 설명하고 (1), (2), (4)에서 나타나는 회귀분석 결과에 대한 관계에 대하여 논의하시오.

```

    방의 수 (1개 증가) ---> 면적 (7.059 증가)

       |                      |

       |                      |   ---> 방의 수 1 증가당 매매가격 31.07089증가

       |                      |

      면적 -------------->  면적 1 증가 당 매매가격 4.4016 증가

```

