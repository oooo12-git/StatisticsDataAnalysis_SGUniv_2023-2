<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="서강대학교 20121802 김재현">
<meta name="dcterms.date" content="2023-12-07">

<title>ch22_MLinearRegression</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ch22_MLinearRegression_files/libs/clipboard/clipboard.min.js"></script>
<script src="ch22_MLinearRegression_files/libs/quarto-html/quarto.js"></script>
<script src="ch22_MLinearRegression_files/libs/quarto-html/popper.min.js"></script>
<script src="ch22_MLinearRegression_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ch22_MLinearRegression_files/libs/quarto-html/anchor.min.js"></script>
<link href="ch22_MLinearRegression_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ch22_MLinearRegression_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ch22_MLinearRegression_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ch22_MLinearRegression_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ch22_MLinearRegression_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#예제-8---다중회귀모형의-회귀방정식" id="toc-예제-8---다중회귀모형의-회귀방정식" class="nav-link active" data-scroll-target="#예제-8---다중회귀모형의-회귀방정식">예제 8 - 다중회귀모형의 회귀방정식</a></li>
  <li><a href="#예제-9---다중회귀모형의-분산분석표-변수에-대한-가설검정" id="toc-예제-9---다중회귀모형의-분산분석표-변수에-대한-가설검정" class="nav-link" data-scroll-target="#예제-9---다중회귀모형의-분산분석표-변수에-대한-가설검정">예제 9 - 다중회귀모형의 분산분석표, 변수에 대한 가설검정</a></li>
  <li><a href="#다중공선성" id="toc-다중공선성" class="nav-link" data-scroll-target="#다중공선성">다중공선성</a>
  <ul class="collapse">
  <li><a href="#예제-10---singularity-문제" id="toc-예제-10---singularity-문제" class="nav-link" data-scroll-target="#예제-10---singularity-문제">예제 10 - Singularity 문제</a></li>
  </ul></li>
  <li><a href="#다중공선성-검토" id="toc-다중공선성-검토" class="nav-link" data-scroll-target="#다중공선성-검토">다중공선성 검토</a>
  <ul class="collapse">
  <li><a href="#예제-11" id="toc-예제-11" class="nav-link" data-scroll-target="#예제-11">예제 11</a></li>
  <li><a href="#분산팽창인자variance-inflation-factorvif" id="toc-분산팽창인자variance-inflation-factorvif" class="nav-link" data-scroll-target="#분산팽창인자variance-inflation-factorvif">분산팽창인자(Variance Inflation Factor,VIF)</a></li>
  <li><a href="#다음-예제" id="toc-다음-예제" class="nav-link" data-scroll-target="#다음-예제">다음 예제</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ch22_MLinearRegression</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>서강대학교 20121802 김재현 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 7, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="예제-8---다중회귀모형의-회귀방정식" class="level2">
<h2 class="anchored" data-anchor-id="예제-8---다중회귀모형의-회귀방정식">예제 8 - 다중회귀모형의 회귀방정식</h2>
<p><strong>(참고) 예제로 생성된 교재에서 사용한 데이터 내용</strong></p>
<pre><code>   x1 x2    y
1   4 14 50.75980
2   1 16 41.39093
3   4 13 23.55423
4   5 19 62.02147
5   1 18 59.09995
6   7 18 77.93622
7  10 12 44.25575
8   4 14 58.86981
9   8 19 82.66984
10 10 13 79.87974</code></pre>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 읽기 - 예제 8</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>rawdata <span class="ot">=</span> <span class="fu">read_excel</span>(<span class="st">"data.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 다중회귀분석 진행 - 예제8</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>M4 <span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2,rawdata)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>M4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2, data = rawdata)

Coefficients:
(Intercept)           x1           x2  
    -35.617        3.716        4.718  </code></pre>
</div>
</div>
<p>이를 회귀방정식으로 나타내면 다음과 같다.</p>
<p><span class="math display">\[\hat{y} = -35.617 + 3.716x_1 + 4.718x_2\]</span></p>
</section>
<section id="예제-9---다중회귀모형의-분산분석표-변수에-대한-가설검정" class="level2">
<h2 class="anchored" data-anchor-id="예제-9---다중회귀모형의-분산분석표-변수에-대한-가설검정">예제 9 - 다중회귀모형의 분산분석표, 변수에 대한 가설검정</h2>
<p><img src="./images/예제9.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 데이터 불러오기 - 예제 9</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">=</span> <span class="fu">read_excel</span>(<span class="st">"아파트매매.xlsx"</span>, <span class="at">sheet=</span><span class="st">'Data'</span>, <span class="at">range=</span><span class="st">'B4:E30'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>R에서는 다중회귀모형에 대한 분산분석표(아래 그림 참고)를 제공하지 않는다. 그러므로, 완전 모형과 Null model간 검정을 이용하여 분산분석표를 작성한다.(Null model은 독립변수를 포함하지 않으므로 제곱합이 다중회귀 분석 모형의 SSE라 볼 수 있다. Null model과 Full model을 비교하는 F검정이 곧 전반검정 - ’모든 독립변수가 필요없다’는 귀무가설을 기각하는지 여부를 따지는 검정 - 이 된다.)</p>
</div>
</div>
<p><img src="./images/예제9-분산분석표.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 완전모형, 부분모형(Rooms 변수만 제외한 모형 - 1 , Area 변수만 사용하는 모형 - 2), null model</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>FullModel <span class="ot">=</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> . , df1)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>PartialModel1 <span class="ot">=</span> <span class="fu">update</span>(FullModel, .<span class="sc">~</span>.<span class="sc">-</span>Rooms)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>PartialModel2 <span class="ot">=</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> Area , df1)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>NullModel <span class="ot">=</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> <span class="dv">1</span> , df1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 다중회귀모형 완전모형에 대한 분산분석표(각 회귀 계수에 대한 F 검정)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>F1 <span class="ot">=</span> <span class="fu">anova</span>(FullModel); F1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: Sales
          Df Sum Sq Mean Sq  F value  Pr(&gt;F)    
Dur        1   1615    1615   5.7892 0.02497 *  
Area       1  38404   38404 137.7028 6.1e-11 ***
Rooms      1     38      38   0.1378 0.71404    
Residuals 22   6136     279                     
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>여기서도 분산분석표를 만들 수 있다. Dur, Area, Rooms의 Sum of Square를 더하면 SSR이 된다. 이를 SSR의 자유도 3(k = 독립변수 갯수)으로 나누면 MSR이 된다.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MSR 계산 - anova(Fullmodel) 활용</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>SSR <span class="ot">=</span> <span class="fu">sum</span>(F1[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">2</span>])</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>MSR <span class="ot">=</span> SSR<span class="sc">/</span><span class="dv">3</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>MSR</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13352.23</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Residuals 의 Mean Square는 MSE에 해당한다. 앞에서 구한 MSR을 MSE로 나누면 F검정을 위한 F값이 만들어진다. 분자자유도 3, 분모자유도 22의 F분포를 이용하여 F검정을 진행할 수 있다.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># F검정 - anova(Fullmodel) 활용</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>Fvalue <span class="ot">=</span> MSR<span class="sc">/</span>F1[<span class="dv">4</span>,<span class="dv">3</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>Fvalue</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 47.8766</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">pf</span>(Fvalue,<span class="dv">3</span>,<span class="dv">22</span>) <span class="co"># p값 계산</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.23094e-10</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># NullModel과 FullModel에 대한 비교 분산분석</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(NullModel, FullModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: Sales ~ 1
Model 2: Sales ~ Dur + Area + Rooms
  Res.Df   RSS Df Sum of Sq      F    Pr(&gt;F)    
1     25 46192                                  
2     22  6136  3     40057 47.877 8.231e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>여기서 NullModel의 RSS(Residual Sum of Squares)는 분산분석표의 SST가 된다.(NullModel에 의한 예측값은 실제값에 대해 아무것도 설명하고 있지 않기 때문에 RSS가 분산분석표의 SST와 같게 된다.) FullModel의 RSS는 오차 제곱합이므로 분산분석표의 SSE가 된다. 그러므로 Nullmodel과 Fullmodel의 RSS 차이는 SSR이 될 것이다. F-value는 MSR/MSE이므로 이는 앞서 확인한 SSR과 SSE를 자유도(3, 22)로 나눠서 그 비율을 확인하면 된다. 앞서 다른 방법의 계산결과와 동일한 F값과 p-value를 확인할 수 있다.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># r^2, adj r^2, MSE, AIC, BIC 확인(Fullmodel)</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(FullModel)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8671737</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(FullModel)<span class="sc">$</span>adj.r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.849061</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(FullModel)<span class="sc">^</span><span class="dv">2</span> <span class="co"># MSE = 잔차 표준오차(잔차 표준편차를 자유도로 나눈 것)의 제곱 </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 278.8884</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(FullModel) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 225.8425</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(FullModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 232.133</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># r^2, adj r^2, MSE, AIC, BIC 확인(Fullmodel)</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"># PartialModel1 = 기간 + 면적(Dur + Area)</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PartialModel1)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8663418</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PartialModel1)<span class="sc">$</span>adj.r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8547193</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(PartialModel1)<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 268.4336</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(PartialModel1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 224.0048</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(PartialModel1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 229.0372</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># r^2, adj r^2, MSE, AIC, BIC 확인(PartialModel2)</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># PartialModel2 = 면적(Area)</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PartialModel2)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.821837</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PartialModel2)<span class="sc">$</span>adj.r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8144135</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sigma</span>(PartialModel2)<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 342.9062</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(PartialModel2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 229.4776</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(PartialModel2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 233.2519</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>위 결과로 봤을 때, AIC, BIC, MSE가 가장 작고 adj-R^2가 가장 높은 PartialModel1이 가장 적합한 모형으로 보인다.</p>
<p>FullModel과 PartialModel1의 차이는 Rooms 변수의 유무이다. FullModel의 Summary를 통해 Rooms의 t값을 통해 회귀계수의 통계적 유의성을 확인하여, 통계적으로 유의하지 않다면, Rooms가 없는 PartialModel1이 더 적합한 모형이라 할 수 있다.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rooms의 통계적 유의성 확인</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(FullModel) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sales ~ ., data = df1)

Residuals:
    Min      1Q  Median      3Q     Max 
-31.348 -11.449   0.434   9.301  33.519 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 65.62718   18.82063   3.487  0.00209 ** 
Dur         -0.16839    0.06147  -2.739  0.01197 *  
Area         5.04363    0.62078   8.125 4.56e-08 ***
Rooms       -2.01249    5.42161  -0.371  0.71404    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 16.7 on 22 degrees of freedom
Multiple R-squared:  0.8672,    Adjusted R-squared:  0.8491 
F-statistic: 47.88 on 3 and 22 DF,  p-value: 8.231e-10</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Rooms의 p-value는 0.71404로 귀무가설(Rooms의 계수 = 0)을 기각할 수 없다. 그러므로 Rooms는 통계적으로 유의하지 않은 독립변수이다. 이는 PartialModel1이 더 적합한 모형임을 뒷받침해준다.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>이때 Rooms 변수를 제외한 것은 Rooms변수가 매매가격을 예측하는데 영향력이 없기 때문이 아니라, Area 변수가 이미 Rooms 변수가 설명하는 부분을 설명하고 있기 때문에, Rooms 변수가 추가적으로 설명할 부분이 없기 때문에 제외된 것이라고 해석해야 한다.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PartialModel1을 이용한 30일된 32평 방 5개 아파트 가격 평균값의 95% 신뢰구간</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(PartialModel1, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">Dur=</span><span class="dv">30</span>, <span class="at">Area=</span><span class="dv">32</span>), <span class="at">interval=</span><span class="st">"confidence"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 211.5292 196.8789 226.1795</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PartialModel1을 이용한 30일된 32평 방 5개 아파트 가격의 95% 신뢰구간</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(PartialModel1, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">Dur=</span><span class="dv">30</span>, <span class="at">Area=</span><span class="dv">32</span>), <span class="at">interval=</span><span class="st">"prediction"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 211.5292 174.6056 248.4528</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>이 아파트는 2억1천1백만원 정도로 매매가격을 추정할 수 있다.</p>
<p>만일 매매가격이 2억 4천 8백만원이상 이면 이례적으로 비싼 가격(극단값)이라 판단할 수 있다.</p>
<p>반대로 1억 7천 5백만원 이하로 매매가 이루어지기는 어렵다고 볼 수 있다.</p>
</div>
</div>
</section>
<section id="다중공선성" class="level2">
<h2 class="anchored" data-anchor-id="다중공선성">다중공선성</h2>
<section id="예제-10---singularity-문제" class="level3">
<h3 class="anchored" data-anchor-id="예제-10---singularity-문제">예제 10 - Singularity 문제</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>높은 다중공선성을 가진 독립변수가 발견되면 모형에서 제거하는 것이 기본적인 해결방법이다. 하지만, 제거하는 이유가 종속변수 Y를 예측하는 데 중요한 변수가 아니기 때문에 제거하는 것이 아니라, 최소제곱법이 회귀분석결과를 안정적으로 제공하지 못하게 만들기 때문에 제거하는 것이다. - 데이터 사이언스 통계학, 이군희, 2023</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 완벽한 상관관계를 갖는 두 독립변수가 포함된 회귀 분석</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>x1<span class="ot">=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>x2<span class="ot">=</span><span class="dv">21</span><span class="sc">:</span><span class="dv">30</span> </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x1 <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>x2 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>M5 <span class="ot">=</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2); <span class="fu">summary</span>(M5) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x1 + x2)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.7686 -7.0445 -0.1041  3.6702 11.8471 

Coefficients: (1 not defined because of singularities)
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  64.4545     5.5343  11.646 2.69e-06 ***
x1            4.3686     0.8919   4.898   0.0012 ** 
x2                NA         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 8.101 on 8 degrees of freedom
Multiple R-squared:  0.7499,    Adjusted R-squared:  0.7187 
F-statistic: 23.99 on 1 and 8 DF,  p-value: 0.001197</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><code>Coefficients: (1 not defined because of singularities)</code></p>
<p>singularity 문제가 발생하여 x2에 대한 추정이 이루어지지 않았다.</p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>독립변수간에 높은 상관관계(상관계수의 절대값이 1에 가까운 경우)를 가지면 이러한 singularity 문제가 발생한다.</p>
</div>
</div>
<p>singularity 문제가 발생하지 않더라도 두 독립변수의 상관관계가 높으면 회귀분석에 의한 결과가 상당부분 왜곡되어 나타난다. 이를 <strong>다중공선성 문제</strong>라고 한다.</p>
<p>다중공선성 문제가 발생하면, 회귀계수<span class="math inline">\(b_j\)</span>의 값이 불안정(회귀계수의 분산이 커진다 = 정확성이 떨어진다)하며 회귀계수 <span class="math inline">\(b_j\)</span>의 표준오차 <span class="math inline">\(\hat{\sigma}(b_j)\)</span>가 커져서 회귀계수의 p값이 크게 나타난다.(이러한 현상을 분산팽창(Variance Inflation)이라고 한다.)</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>회귀모형의 적합도는 괜찮지만, 회귀계수의 p값이 모두 크게 나타나 유의한 변수가 발견되지 않는 경우라면 다중공선성 문제를 생각해볼 수 있다.</p>
</div>
</div>
</section>
</section>
<section id="다중공선성-검토" class="level2">
<h2 class="anchored" data-anchor-id="다중공선성-검토">다중공선성 검토</h2>
<section id="예제-11" class="level3">
<h3 class="anchored" data-anchor-id="예제-11">예제 11</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># chart.Correlation 그래프를 통한 다중공선성 검토</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>PerformanceAnalytics<span class="sc">::</span><span class="fu">chart.Correlation</span>(df1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in par(usr): argument 1 does not name a graphical parameter

Warning in par(usr): argument 1 does not name a graphical parameter

Warning in par(usr): argument 1 does not name a graphical parameter

Warning in par(usr): argument 1 does not name a graphical parameter

Warning in par(usr): argument 1 does not name a graphical parameter

Warning in par(usr): argument 1 does not name a graphical parameter</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ch22_MLinearRegression_files/figure-html/chart.Correlation%20그래프를%20통한%20다중공선성%20검토-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>chart.correlation을 통해 Rooms와 Area에 높은 상관관계가 있음을 확인했다. 앞서 Rooms가 포함된 Fullmodel에서 Rooms의 회귀계수에 대한 t검정(부분검정)의 p값이 컸던 것을 보면, 왜곡된 결과를 내놓을 수 있기 때문에 다중공선성 문제가 있다고 보고 Rooms를 제외하는 것이 맞다.</p>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>반대로, Dur과 Area의 상관관계는 유의한 정도로 보이지만, Dur과 Area 두 변수만 포함된 Partialmodel1에서 두 변수는 모두 통계적으로 유의하고, 회귀계수의 부호 또한 설명 가능하기 때문에, 다중공선성의 문제는 발생하지 않았다고 보는게 합당하다.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># PartialModel1의 두 독립변수의 통계적 유의성 확인</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(PartialModel1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sales ~ Dur + Area, data = df1)

Residuals:
    Min      1Q  Median      3Q     Max 
-30.392 -11.291  -0.187   9.193  34.303 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 60.59166   12.79888   4.734 9.03e-05 ***
Dur         -0.16590    0.05995  -2.767    0.011 *  
Area         4.87233    0.40735  11.961 2.36e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 16.38 on 23 degrees of freedom
Multiple R-squared:  0.8663,    Adjusted R-squared:  0.8547 
F-statistic: 74.54 on 2 and 23 DF,  p-value: 8.891e-11</code></pre>
</div>
</div>
</section>
<section id="분산팽창인자variance-inflation-factorvif" class="level3">
<h3 class="anchored" data-anchor-id="분산팽창인자variance-inflation-factorvif">분산팽창인자(Variance Inflation Factor,VIF)</h3>
<p>분산팽창인자는 다음과 같다. <span class="math display">\[VIF_j = \frac{1}{1-R_j^2}\]</span></p>
<p><span class="math inline">\(R_j^2\)</span>는 j번째 독립변수를 종속변수로 하고 나머지 독립변수로 회귀모형을 만들었을 때 회귀모형의 결정계수이다. 보통 VIF가 5보다 크면 다중공선성 문제를 의심하고 10보다 크면 심각하다고 판단한다. 하지만, 절대적인 기준은 없다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vif 확인 - Full, PartialModel1</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(FullModel) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Dur     Area    Rooms 
1.225876 2.707717 2.387637 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(PartialModel1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Dur     Area 
1.211306 1.211306 </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Rooms 변수는 위에서는 다중공선성 문제 때문에 제외했지만 VIF만 봤을 때에는 5보다 작기 때문에 다중공선성 문제가 있다고 의심하기 어렵다. 이 예제를 통해, VIF가 5보다 작더라도 다중공선성문제가 생길 수 있음을 명심해야 한다.</p>
</div>
</div>
</section>
<section id="다음-예제" class="level3">
<h3 class="anchored" data-anchor-id="다음-예제">다음 예제</h3>
<p>매출액 영업활동비용 영업사원수 (억원) (천만원) (명)</p>
<p>Sales SalesCost NSalesMan 22 8 6 23 10 7 18 7 5 9 2 2 14 4 3 20 6 4 21 7 4 18 6 3 16 4 3 19 6 3</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 다음 예제 데이터 불러오기</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>da2<span class="ot">=</span> <span class="fu">read_excel</span>(<span class="st">"./Salesdata.xlsx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sales를 추정하는 다중회귀분석</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>M5 <span class="ot">=</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> SalesCost <span class="sc">+</span> NSalesMan, <span class="at">data=</span>da2)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(M5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sales ~ SalesCost + NSalesMan, data = da2)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.5965 -1.2602 -0.1608  1.1506  2.0000 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   7.9181     1.4498   5.462 0.000944 ***
SalesCost     2.3626     0.5496   4.299 0.003571 ** 
NSalesMan    -1.0234     0.7947  -1.288 0.238745    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.532 on 7 degrees of freedom
Multiple R-squared:  0.8947,    Adjusted R-squared:  0.8646 
F-statistic: 29.73 on 2 and 7 DF,  p-value: 0.0003794</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># da2의 각변수의 상관관계 확인</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">signif</span>(<span class="fu">cor</span>(da2),<span class="dv">3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Sales SalesCost NSalesMan
Sales     1.000     0.933     0.785
SalesCost 0.933     1.000     0.912
NSalesMan 0.785     0.912     1.000</code></pre>
</div>
</div>
<section id="assumption-1-model-specification-error-check-linearity-선형성-가정-확인" class="level4">
<h4 class="anchored" data-anchor-id="assumption-1-model-specification-error-check-linearity-선형성-가정-확인">Assumption 1 : Model Specification Error Check (Linearity) 선형성 가정 확인</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crPlot 사용하여 선형성 확인</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">crPlots</span>(M5)  <span class="co"># Evaluate Nonlinearity: component + residual plot </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ch22_MLinearRegression_files/figure-html/crPlot%20사용하여%20선형성%20확인-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Same as 'Partial Residual Plot' (xi) versus (bi xi + residual)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ceresPlots 사용하여 선형성 확인</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ceresPlots</span>(M5) <span class="co"># Ceres plots: Conditional Expectation Partial Residuals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric,
: pseudoinverse used at 6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric,
: neighborhood radius 2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric,
: reciprocal condition number 4.179e-17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric,
: There are other near singularities as well. 4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric,
: pseudoinverse used at 1.975</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric,
: neighborhood radius 2.025</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric,
: reciprocal condition number 9.0499e-17</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in simpleLoess(y, x, w, span, degree = degree, parametric = parametric,
: There are other near singularities as well. 1</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ch22_MLinearRegression_files/figure-html/ceresPlots%20사용하여%20선형성%20확인-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>CeresPlot은</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>SalesCost와 Ceres 잔차를 보면 선형적으로 증가하는 관계를 보인다. 이는 Sales를 예측함에 있어서 SalesCost가 비선형적인 관계여야할지도 모른다는 점을 암시한다.</p>
<p>이에반해 NSalesMan은 Ceres 잔차와 특별한 관계가 없어보인다. 이는 NSalesMan이 Sales를 예측함에 있어서 선형적인 관계가 맞다는 것을 보여준다.</p>
</div>
</div>
</section>
<section id="evaluate-collinearity-다중-공선성-확인" class="level4">
<h4 class="anchored" data-anchor-id="evaluate-collinearity-다중-공선성-확인">Evaluate Collinearity 다중 공선성 확인</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vif 확인</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(M5) <span class="co"># variance inflation factors </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>SalesCost NSalesMan 
 5.918129  5.918129 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># partialmodel과 fullmodel 비교 분산분석</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>M6 <span class="ot">=</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> SalesCost, <span class="at">data=</span>da2) <span class="co"># Partial Model</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(M5, M6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: Sales ~ SalesCost + NSalesMan
Model 2: Sales ~ SalesCost
  Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
1      7 16.433                           
2      8 20.326 -1   -3.8933 1.6585 0.2387</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>SalesCost와 NSalesMan 변수 두개 다 있을 때 RSS(잔차 제곱합)이 더 작다. 그러나 이에 대한 F값의 p-value를 봤을 때 통계적으로 유의하게 작다고 판단하긴 어렵다.(유의수준 5%에서 생각했을 때)</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 회귀모형 잔차분석 </span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="fu">layout</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>),<span class="dv">2</span>,<span class="dv">2</span>)) <span class="co"># optional 4 graphs/page </span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>   <span class="co"># same as 'par(mfrow=c(2,2))'</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(M6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ch22_MLinearRegression_files/figure-html/회귀모형%20잔차분석-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>왼쪽 위부터 시계방향으로 선형성 확인(모델 적합도), 등분산성 확인, 영향점 확인, 정규성 확인</p>
</div>
</div>
<p>QQ플롯은 정규성을 검정하는데 사용한다.가운데 점선 직선은 이론적인 정규분포일 때 데이터가 위치하는 곳을 뜻한다.</p>
</section>
<section id="assumption-check-in-the-regression-model" class="level4">
<h4 class="anchored" data-anchor-id="assumption-check-in-the-regression-model">Assumption Check in the Regression Model</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gvlma - 일반화된 선형회귀 방정식의 가정에 대한 적절성 확인</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gvlma</span>(M6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sales ~ SalesCost, data = da2)

Coefficients:
(Intercept)    SalesCost  
      7.696        1.717  


ASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS
USING THE GLOBAL TEST ON 4 DEGREES-OF-FREEDOM:
Level of Significance =  0.05 

Call:
 gvlma(x = M6) 

                    Value p-value                   Decision
Global Stat        5.9858 0.20021    Assumptions acceptable.
Skewness           0.1031 0.74820    Assumptions acceptable.
Kurtosis           0.8291 0.36253    Assumptions acceptable.
Link Function      4.8480 0.02768 Assumptions NOT satisfied!
Heteroscedasticity 0.2056 0.65021    Assumptions acceptable.</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Link function에 문제가 있다면 모형의 적합성 문제 즉, 선형성이 아닐수도 있음을 암시한다.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># durbin watson 더빈 왓슨 검정 - 잔차 독립성 검정</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">durbinWatsonTest</span>(M6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> lag Autocorrelation D-W Statistic p-value
   1       0.4863985     0.9622878   0.056
 Alternative hypothesis: rho != 0</code></pre>
</div>
</div>
<p>귀무가설이 상관관계= 0이므로 p값이 충분히 높으면 독립성을 만족한다고 판단할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ncv test 등분산성 검정</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">ncvTest</span>(M6)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Non-constant Variance Score Test 
Variance formula: ~ fitted.values 
Chisquare = 0.03595083, Df = 1, p = 0.84962</code></pre>
</div>
</div>
<p>귀무가설은 잔차가 등분산성을 가진다 이므로 p값이 충분히 높으면 등분산성을 만족한다고 판단할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># shapiro 검정 - 정규성 검정</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">shapiro.test</span>(<span class="fu">residuals</span>(M6))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  residuals(M6)
W = 0.91587, p-value = 0.3238</code></pre>
</div>
</div>
<p>귀무가설은 잔차가 정규성을 가진다 이므로 p값이 충분히 높으면 정규성을 만족한다고 판단할 수 있다.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 산점도를 통한 영향점 확인</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">family =</span> <span class="st">"AppleGothic"</span>)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(da2<span class="sc">$</span>SalesCost, da2<span class="sc">$</span>Sales, <span class="at">pch=</span><span class="dv">20</span>, <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">xlab=</span><span class="st">'영업활동비용'</span>,</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">ylab=</span><span class="st">'매출액'</span>, <span class="at">main=</span><span class="st">'영업활동비용과 매출액 관계'</span>)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(M6, <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ch22_MLinearRegression_files/figure-html/산점도를%20통한%20영향점%20확인-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="regression-with-dummy-variables-chapter-22-더미변수" class="level4">
<h4 class="anchored" data-anchor-id="regression-with-dummy-variables-chapter-22-더미변수">Regression with Dummy variables (Chapter 22) 더미변수</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 더미변수 이용한 회귀분석 예제 데이터 불러오기</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>type<span class="ot">=</span><span class="fu">c</span>(<span class="st">"할인점"</span>,<span class="st">"할인점"</span>,<span class="st">"할인점"</span>,<span class="st">"일반점"</span>,<span class="st">"일반점"</span>,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">"할인점"</span>,<span class="st">"일반점"</span>,<span class="st">"일반점"</span>,<span class="st">"할인점"</span>,<span class="st">"일반점"</span>)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>da3<span class="ot">=</span><span class="fu">cbind</span>(da2, <span class="fu">as.factor</span>(type)) </span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="co">#da2는 앞서 사용했던, Sales, SalesCost, NSalesMan 변수로 이루어진 데이터프레임이다.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model3 - 평행성(parallel)을 가정하지 않고 더미변수와 메트릭 변수가 있는 다중회귀분석</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="co">#평행성이 없다는 건 더미변수와 메트릭 변수의 상호작용효과가 있다는 뜻이다.</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">=</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> SalesCost<span class="sc">*</span>type, <span class="at">data=</span>da3) <span class="co"># Without Parallel</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sales ~ SalesCost * type, data = da3)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.8000 -0.3250 -0.0125  0.3625  1.3500 

Coefficients:
                     Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)            4.3250     1.4237   3.038 0.022865 *  
SalesCost              2.3750     0.2681   8.859 0.000115 ***
type할인점             7.4250     2.2526   3.296 0.016487 *  
SalesCost:type할인점  -1.2250     0.3597  -3.406 0.014394 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.072 on 6 degrees of freedom
Multiple R-squared:  0.9558,    Adjusted R-squared:  0.9337 
F-statistic: 43.22 on 3 and 6 DF,  p-value: 0.0001861</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model4 - 평행성(parallel)을 가정하고 더미변수와 메트릭 변수가 있는 다중회귀분석</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 더미변수와 메트릭 변수의 상호작용효과가 없는 경우에 해당한다.</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>model4 <span class="ot">=</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> SalesCost<span class="sc">+</span>type, <span class="at">data=</span>da3) <span class="co"># With Parallel</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sales ~ SalesCost + type, data = da3)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.1167 -1.4764  0.3056  1.2389  1.8944 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   7.7278     1.6081   4.805 0.001954 ** 
SalesCost     1.6944     0.2834   5.979 0.000554 ***
type할인점    0.2111     1.2156   0.174 0.867045    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.7 on 7 degrees of freedom
Multiple R-squared:  0.8703,    Adjusted R-squared:  0.8332 
F-statistic: 23.48 on 2 and 7 DF,  p-value: 0.0007865</code></pre>
</div>
</div>
<p>두 결과를 비교해보면 상호작용을 고려한 model3의 <span class="math inline">\(adj-R^2\)</span>가 0.9337로 model4의 <span class="math inline">\(adj-R^2\)</span>(0.8332)보다 훨씬 좋다. 또한 상호작용항의 통계적 유의성도 있는 것으로 나타나기 때문에 평행성 가정을 하지 않은 회귀모형의 성능이 뛰어난 것으로 판단할 수 있다.</p>
<pre><code>                     Estimate Std. Error t value Pr(&gt;|t|)
SalesCost:type할인점  -1.2250     0.3597  -3.406 0.014394 * </code></pre>
</section>
<section id="model-building-variable-selection-chapter-22" class="level4">
<h4 class="anchored" data-anchor-id="model-building-variable-selection-chapter-22">Model Building: Variable Selection (Chapter 22)</h4>
<p>Selecting a subset of X variables (or predictor) from a larger set (e.g., stepwise selection) is a controversial topic. You can perform stepwise selection (forward, backward, both) using the stepAIC( ) function from the MASS package. Selection of terms for deletion or inclusion is based on AIC (Akaike’s information criterion). R defines AIC as</p>
<pre><code>  -2 maximized log-likelihood + 2 number of parameters</code></pre>
<p>stepAIC( ) performs stepwise model selection by exact AIC.</p>
<section id="stepwise-regression-단계별-선택법변수추가법-변수제거법" class="level5">
<h5 class="anchored" data-anchor-id="stepwise-regression-단계별-선택법변수추가법-변수제거법">Stepwise Regression 단계별 선택법(변수추가법 + 변수제거법)</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model selection - 단계별 선택법</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>model5 <span class="ot">=</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> SalesCost<span class="sc">*</span>NSalesMan<span class="sc">*</span>type, <span class="at">data=</span>da3)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>step <span class="ot">&lt;-</span> <span class="fu">stepAIC</span>(model5, <span class="at">direction=</span><span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=12.08
Sales ~ SalesCost * NSalesMan * type

                           Df Sum of Sq    RSS    AIC
- SalesCost:NSalesMan:type  1 0.0011818 6.7598 10.084
&lt;none&gt;                                  6.7586 12.082

Step:  AIC=10.08
Sales ~ SalesCost + NSalesMan + type + SalesCost:NSalesMan + 
    SalesCost:type + NSalesMan:type

                           Df Sum of Sq    RSS     AIC
- SalesCost:NSalesMan       1  0.054483 6.8143  8.1644
- NSalesMan:type            1  0.079042 6.8388  8.2003
- SalesCost:type            1  0.158662 6.9185  8.3161
&lt;none&gt;                                  6.7598 10.0841
+ SalesCost:NSalesMan:type  1  0.001182 6.7586 12.0823

Step:  AIC=8.16
Sales ~ SalesCost + NSalesMan + type + SalesCost:type + NSalesMan:type

                      Df Sum of Sq    RSS     AIC
- NSalesMan:type       1  0.084734 6.8990  6.2879
- SalesCost:type       1  0.221612 7.0359  6.4844
&lt;none&gt;                             6.8143  8.1644
+ SalesCost:NSalesMan  1  0.054483 6.7598 10.0841

Step:  AIC=6.29
Sales ~ SalesCost + NSalesMan + type + SalesCost:type

                      Df Sum of Sq     RSS    AIC
- NSalesMan            1    0.0010  6.9000 4.2894
&lt;none&gt;                              6.8990 6.2879
+ NSalesMan:type       1    0.0847  6.8143 8.1644
+ SalesCost:NSalesMan  1    0.0602  6.8388 8.2003
- SalesCost:type       1    4.4193 11.3183 9.2384

Step:  AIC=4.29
Sales ~ SalesCost + type + SalesCost:type

                 Df Sum of Sq    RSS     AIC
&lt;none&gt;                         6.900  4.2894
+ NSalesMan       1     0.001  6.899  6.2879
- SalesCost:type  1    13.339 20.239 13.0502</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>step<span class="sc">$</span>anova <span class="co"># display results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Stepwise Model Path 
Analysis of Deviance Table

Initial Model:
Sales ~ SalesCost * NSalesMan * type

Final Model:
Sales ~ SalesCost + type + SalesCost:type

                        Step Df     Deviance Resid. Df Resid. Dev       AIC
1                                                    2   6.758621 12.082337
2 - SalesCost:NSalesMan:type  1 0.0011818491         3   6.759803 10.084086
3      - SalesCost:NSalesMan  1 0.0544831755         4   6.814286  8.164362
4           - NSalesMan:type  1 0.0847338936         5   6.899020  6.287942
5                - NSalesMan  1 0.0009803922         6   6.900000  4.289363</code></pre>
</div>
</div>
</section>
<section id="a-little-more-investigation-in-r" class="level5">
<h5 class="anchored" data-anchor-id="a-little-more-investigation-in-r">A little more investigation in R</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pairs() - 변수간 관계를 볼 수 있는 산점도</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(da2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ch22_MLinearRegression_files/figure-html/pairs()%20-%20변수간%20관계를%20볼%20수%20있는%20산점도-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model selection - 변수제거법</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="fu">step</span>(model5, <span class="at">direction=</span><span class="st">"backward"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=12.08
Sales ~ SalesCost * NSalesMan * type

                           Df Sum of Sq    RSS    AIC
- SalesCost:NSalesMan:type  1 0.0011818 6.7598 10.084
&lt;none&gt;                                  6.7586 12.082

Step:  AIC=10.08
Sales ~ SalesCost + NSalesMan + type + SalesCost:NSalesMan + 
    SalesCost:type + NSalesMan:type

                      Df Sum of Sq    RSS     AIC
- SalesCost:NSalesMan  1  0.054483 6.8143  8.1644
- NSalesMan:type       1  0.079042 6.8388  8.2003
- SalesCost:type       1  0.158662 6.9185  8.3161
&lt;none&gt;                             6.7598 10.0841

Step:  AIC=8.16
Sales ~ SalesCost + NSalesMan + type + SalesCost:type + NSalesMan:type

                 Df Sum of Sq    RSS    AIC
- NSalesMan:type  1  0.084734 6.8990 6.2879
- SalesCost:type  1  0.221612 7.0359 6.4844
&lt;none&gt;                        6.8143 8.1644

Step:  AIC=6.29
Sales ~ SalesCost + NSalesMan + type + SalesCost:type

                 Df Sum of Sq    RSS    AIC
- NSalesMan       1    0.0010  6.900 4.2894
&lt;none&gt;                         6.899 6.2879
- SalesCost:type  1    4.4193 11.318 9.2384

Step:  AIC=4.29
Sales ~ SalesCost + type + SalesCost:type

                 Df Sum of Sq    RSS     AIC
&lt;none&gt;                         6.900  4.2894
- SalesCost:type  1    13.339 20.239 13.0502</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sales ~ SalesCost + type + SalesCost:type, data = da3)

Coefficients:
         (Intercept)             SalesCost            type할인점  
               4.325                 2.375                 7.425  
SalesCost:type할인점  
              -1.225  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model selection - 변수추가법(null model과 scope를 지정하고)</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>scope <span class="ot">=</span> <span class="fu">formula</span>(<span class="sc">~</span>SalesCost<span class="sc">*</span>NSalesMan<span class="sc">*</span>type)</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>null <span class="ot">=</span> <span class="fu">lm</span>(Sales <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data=</span>da3)</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="fu">step</span>(null, scope, <span class="at">direction=</span><span class="st">"forward"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=29.47
Sales ~ 1

            Df Sum of Sq     RSS    AIC
+ SalesCost  1   135.674  20.326 11.093
+ NSalesMan  1    96.182  59.818 21.887
+ type       1    32.400 123.600 29.145
&lt;none&gt;                   156.000 29.473

Step:  AIC=11.09
Sales ~ SalesCost

            Df Sum of Sq    RSS    AIC
+ NSalesMan  1    3.8933 16.433 10.967
&lt;none&gt;                   20.326 11.093
+ type       1    0.0872 20.239 13.050

Step:  AIC=10.97
Sales ~ SalesCost + NSalesMan

                      Df Sum of Sq    RSS     AIC
+ SalesCost:NSalesMan  1    5.8103 10.622  8.6038
+ type                 1    5.1144 11.318  9.2384
&lt;none&gt;                             16.433 10.9669

Step:  AIC=8.6
Sales ~ SalesCost + NSalesMan + SalesCost:NSalesMan

       Df Sum of Sq     RSS    AIC
&lt;none&gt;              10.6224 8.6038
+ type  1    1.6549  8.9675 8.9102</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sales ~ SalesCost + NSalesMan + SalesCost:NSalesMan, 
    data = da3)

Coefficients:
        (Intercept)            SalesCost            NSalesMan  
             1.7029               2.8637               1.5093  
SalesCost:NSalesMan  
            -0.2573  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model selection - 단계별 선택법(null model과 scope를 지정하고)</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="fu">step</span>(null, scope, <span class="at">direction=</span><span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=29.47
Sales ~ 1

            Df Sum of Sq     RSS    AIC
+ SalesCost  1   135.674  20.326 11.093
+ NSalesMan  1    96.182  59.818 21.887
+ type       1    32.400 123.600 29.145
&lt;none&gt;                   156.000 29.473

Step:  AIC=11.09
Sales ~ SalesCost

            Df Sum of Sq     RSS    AIC
+ NSalesMan  1     3.893  16.433 10.967
&lt;none&gt;                    20.326 11.093
+ type       1     0.087  20.239 13.050
- SalesCost  1   135.674 156.000 29.473

Step:  AIC=10.97
Sales ~ SalesCost + NSalesMan

                      Df Sum of Sq    RSS     AIC
+ SalesCost:NSalesMan  1     5.810 10.622  8.6038
+ type                 1     5.114 11.318  9.2384
&lt;none&gt;                             16.433 10.9669
- NSalesMan            1     3.893 20.326 11.0932
- SalesCost            1    43.385 59.818 21.8872

Step:  AIC=8.6
Sales ~ SalesCost + NSalesMan + SalesCost:NSalesMan

                      Df Sum of Sq     RSS     AIC
&lt;none&gt;                             10.6224  8.6038
+ type                 1    1.6549  8.9675  8.9102
- SalesCost:NSalesMan  1    5.8103 16.4327 10.9669</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sales ~ SalesCost + NSalesMan + SalesCost:NSalesMan, 
    data = da3)

Coefficients:
        (Intercept)            SalesCost            NSalesMan  
             1.7029               2.8637               1.5093  
SalesCost:NSalesMan  
            -0.2573  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict() 이용하여 추정값 및 신뢰구간 구하기</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>model7<span class="ot">=</span><span class="fu">lm</span>(Sales <span class="sc">~</span> SalesCost<span class="sc">*</span>NSalesMan, <span class="at">data=</span>da3)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model7, <span class="fu">list</span>(<span class="at">SalesCost=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">8</span>), <span class="at">NSalesMan=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>)), <span class="at">interval=</span><span class="st">"conf"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 14.59756 13.06810 16.12703
2 21.31628 19.24699 23.38557</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># SalesCost = 4이고, NSalesMan이 3일때, Sales의 추정값과 95% 신뢰구간</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="co"># SalesCost = 8이고, NSalesMan이 6일때, Sales의 추정값과 95% 신뢰구간</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model7의 summary</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model7)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sales ~ SalesCost * NSalesMan, data = da3)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.2886 -0.5531  0.1637  0.6176  1.4024 

Coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept)           1.7029     3.6545   0.466  0.65768   
SalesCost             2.8637     0.5516   5.191  0.00203 **
NSalesMan             1.5093     1.5591   0.968  0.37040   
SalesCost:NSalesMan  -0.2573     0.1420  -1.812  0.12001   
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.331 on 6 degrees of freedom
Multiple R-squared:  0.9319,    Adjusted R-squared:  0.8979 
F-statistic: 27.37 on 3 and 6 DF,  p-value: 0.0006727</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># scale()를 이용하여 데이터를 표준화(Standardized)하고 회귀분석 - model7S</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>model7S<span class="ot">=</span><span class="fu">lm</span>(<span class="fu">scale</span>(Sales) <span class="sc">~</span> <span class="fu">scale</span>(SalesCost)<span class="sc">*</span><span class="fu">scale</span>(NSalesMan),<span class="at">data=</span>da3)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model7S)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = scale(Sales) ~ scale(SalesCost) * scale(NSalesMan), 
    data = da3)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.54971 -0.13284  0.03932  0.14835  0.33685 

Coefficients:
                                  Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept)                        0.17925    0.14143   1.267   0.2520  
scale(SalesCost)                   0.99610    0.30370   3.280   0.0168 *
scale(NSalesMan)                  -0.01303    0.33041  -0.039   0.9698  
scale(SalesCost):scale(NSalesMan) -0.21848    0.12060  -1.812   0.1200  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3196 on 6 degrees of freedom
Multiple R-squared:  0.9319,    Adjusted R-squared:  0.8979 
F-statistic: 27.37 on 3 and 6 DF,  p-value: 0.0006727</code></pre>
</div>
</div>
<p>표준화하고 회귀분석한 결과와 그렇지 않은 결과의 <span class="math inline">\(adj-R^2\)</span>는 같다. 그러나, 각 회귀계수의 통계적 유의성은 변동이 있었다.</p>
</section>
<section id="all-subset-regression-extra-topic" class="level5">
<h5 class="anchored" data-anchor-id="all-subset-regression-extra-topic">All subset Regression (Extra topic)</h5>
<p>Alternatively, you can perform all-subsets regression using the <strong>leaps()</strong> function from the <strong>leaps package.</strong> In the following code <strong>nbest</strong> indicates the number of subsets of each size to report. Here, the ten best models will be reported for each subset size (1 predictor, 2 predictors, etc.).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>leaps<span class="ot">=</span><span class="fu">regsubsets</span>(Sales<span class="sc">~</span>SalesCost<span class="sc">*</span>NSalesMan<span class="sc">*</span>type, <span class="at">data=</span>da3, <span class="at">nbest=</span><span class="dv">2</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(leaps) <span class="co"># view results </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Subset selection object
Call: regsubsets.formula(Sales ~ SalesCost * NSalesMan * type, data = da3, 
    nbest = 2)
7 Variables  (and intercept)
                               Forced in Forced out
SalesCost                          FALSE      FALSE
NSalesMan                          FALSE      FALSE
type할인점                         FALSE      FALSE
SalesCost:NSalesMan                FALSE      FALSE
SalesCost:type할인점               FALSE      FALSE
NSalesMan:type할인점               FALSE      FALSE
SalesCost:NSalesMan:type할인점     FALSE      FALSE
2 subsets of each size up to 7
Selection Algorithm: exhaustive
         SalesCost NSalesMan type할인점 SalesCost:NSalesMan
1  ( 1 ) "*"       " "       " "        " "                
1  ( 2 ) " "       " "       " "        "*"                
2  ( 1 ) "*"       " "       " "        "*"                
2  ( 2 ) "*"       " "       " "        " "                
3  ( 1 ) "*"       " "       "*"        " "                
3  ( 2 ) "*"       " "       "*"        " "                
4  ( 1 ) "*"       " "       "*"        " "                
4  ( 2 ) "*"       " "       "*"        " "                
5  ( 1 ) "*"       "*"       "*"        " "                
5  ( 2 ) "*"       " "       "*"        "*"                
6  ( 1 ) "*"       "*"       "*"        "*"                
6  ( 2 ) "*"       "*"       "*"        " "                
7  ( 1 ) "*"       "*"       "*"        "*"                
         SalesCost:type할인점 NSalesMan:type할인점
1  ( 1 ) " "                  " "                 
1  ( 2 ) " "                  " "                 
2  ( 1 ) " "                  " "                 
2  ( 2 ) " "                  " "                 
3  ( 1 ) "*"                  " "                 
3  ( 2 ) " "                  " "                 
4  ( 1 ) "*"                  " "                 
4  ( 2 ) "*"                  "*"                 
5  ( 1 ) "*"                  " "                 
5  ( 2 ) "*"                  " "                 
6  ( 1 ) "*"                  "*"                 
6  ( 2 ) "*"                  "*"                 
7  ( 1 ) "*"                  "*"                 
         SalesCost:NSalesMan:type할인점
1  ( 1 ) " "                           
1  ( 2 ) " "                           
2  ( 1 ) " "                           
2  ( 2 ) "*"                           
3  ( 1 ) " "                           
3  ( 2 ) "*"                           
4  ( 1 ) "*"                           
4  ( 2 ) " "                           
5  ( 1 ) "*"                           
5  ( 2 ) "*"                           
6  ( 1 ) " "                           
6  ( 2 ) "*"                           
7  ( 1 ) "*"                           </code></pre>
</div>
</div>
<p>Other options for plot() are bic, Cp, and adjr2. Other options for plotting with subset() are bic, cp, adjr2, and rss.</p>
</section>
</section>
<section id="influential-diagonosis-outlierleverage-extra-topic" class="level4">
<h4 class="anchored" data-anchor-id="influential-diagonosis-outlierleverage-extra-topic">Influential Diagonosis: Outlier+Leverage (Extra topic)</h4>
<section id="assessing-outliers" class="level5">
<h5 class="anchored" data-anchor-id="assessing-outliers">Assessing Outliers</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># outlierTest() = Bonferonni 방식으로 아웃라이어 탐색</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">outlierTest</span>(model3) <span class="co"># Bonferonni p-value for most extreme obs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>No Studentized residuals with Bonferroni p &lt; 0.05
Largest |rstudent|:
  rstudent unadjusted p-value Bonferroni p
3 -2.66557           0.044585      0.44585</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 정규성 검정을 위한 qqPlot()</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqPlot</span>(model3, <span class="at">main=</span><span class="st">"QQ Plot"</span>) <span class="co">#qq plot for studentized resid </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ch22_MLinearRegression_files/figure-html/정규성%20검정을%20위한%20qqPlot()-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3 6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leveragePlots</span>(model3) <span class="co"># Regression Leverage Plots</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="ch22_MLinearRegression_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Same as Added-Variable plots: (X|Others) versus (Y|Others) </span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>   <span class="co"># added variable plots: 'av.Plots(model1)' R에서 곧 없어짐</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="influential-observations-cooks-d" class="level5">
<h5 class="anchored" data-anchor-id="influential-observations-cooks-d">Influential Observations : Cook’s D</h5>
<p>Cook’s distance measures the effect of deleting a given observation. Data points with large residuals (outliers) and/or high leverage may distort the outcome and accuracy of a regression. Points with a large Cook’s distance are considered to merit closer examination in the analysis (if D &gt; 4/(n-(k+1))).</p>
<pre><code>   Sum_j (yhat_j - yhat_j(-i))^2</code></pre>
<p>Di = —————————– k MSE</p>
<p>cutoff &lt;- 4/((nrow(da2)-length(model1$coefficients))) plot(model1, which=4); abline(h=cutoff)</p>
<p>influencePlot(model1, id.method=“identify”, main=“Influence Plot”, sub=“Circle size is proportial to Cook’s Distance” ) # Influence Plot</p>
<p>===== (논의 사항) =======</p>
<p>df1=read.table(“clipboard”, h=T) lm(sales~area+rooms, da=df1) lm(sales~area, da=df1) lm(sales~rooms, da=df1)</p>
<p>library(lavaan) M1 = ’ # direct effect sales ~ c<em>rooms # mediator area ~ a</em>rooms sales ~ b<em>area # indirect effect (a</em>b) ab := a<em>b # total effect total := c + (a</em>b) ’</p>
<p>fit1 = sem(M1, data=df1) summary(fit1) # summary(fit_analysis, standardized=T, rsquare=T)</p>
<p>library(semPlot) semPaths(fit1, whatLabels=“par”, intercepts=TRUE, style=“lisrel”, nCharNodes=0, nCharEdges=0, rotation=2, edge.label.position=.43, edge.label.cex=0.9, curveAdjacent=TRUE, title=TRUE, layout=“tree2”, curvePivot=TRUE)</p>
</section>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>